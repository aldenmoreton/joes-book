{% extends "authenticated.html" %}
{%- import "components/get_form_values.html" as form_values -%}

{% block title %}{{ chapter.title }}{% endblock %}

{% block head %}
	<script src="/public/js/json-enc.js"></script>
	{% call form_values::get_form_values("pickinputs") %}
{% endblock %}

{% block content %}
	{% call super() %}
	{% if is_admin %}
		<a href="admin/">Go to Admin Page</a>
	{% endif %}

	{% for (event, pick) in user_picks %}
		{% match event.contents.0 %}
		{% when EventContent::SpreadGroup with (spreads) %}
			{% call spread_group(spreads, pick) %}
		{% when EventContent::UserInput with (input) %}
			{% call user_input(input, pick) %}
		{% endmatch %}
		{% if !loop.last %}
		<hr>
		{% endif %}
	{% else %}
		<p>No Events in this Chapter</p>
	{% endfor %}
	<form id="submit-picks" hx-post="." hx-ext="json-enc" hx-vals="js:{picks: get_forms()}">
		<button type="submit">Submit</button>
	</form>
{% endblock %}

{% macro spread_group(spread, picks) %}
{% let home_team = relevent_teams.get(spread.home_id).unwrap() %}
{% let away_team = relevent_teams.get(spread.away_id).unwrap() %}
<div class="columns-2">
	<div>
		<img class="object-center" src="{{home_team.1.as_ref().unwrap()}}" alt="{{home_team.0}} Image">
		<figcaption>{{home_team.0}}<br>{{ "{:+}"|format(spread.home_spread)}}</figcaption>
	</div>
	<div>
		<img class="object-center" src="{{away_team.1.as_ref().unwrap()}}" alt="{{away_team.0}} Image">
		<figcaption>{{away_team.0}}<br>{{ "{:+}"|format(-1.0 * spread.home_spread)}}</figcaption>
	</div>
</div>
{% if let Some(notes) = spread.notes %}
	<p>{{notes}}</p>
{% endif %}

<p>Picks: {{ "{:?}"|format(picks) }}</p>
{% endmacro %}

{% macro user_input(input, pick) %}
	<form class="pickinputs">
		<h3 class="text-lg font-semibold">{{input.title}}</h3>
		{% if let Some(description) = input.description %}
			<h4>{{description}}</h4>
		{% endif %}
		{% if input.points == 1 %}
			<p>({{input.points}} Point)</p>
		{% else %}
			<p>({{input.points}} Points)</p>
		{% endif %}
		{% if let Some(pick) = pick %}
		<input type="text" name="user-input" placeholder="Your Answer" value={{pick.choice}}>
		{% else %}
		<input type="text" name="user-input" placeholder="Your Answer">
		{% endif %}
	</form>
{% endmacro %}
