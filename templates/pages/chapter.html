{% extends "authenticated.html" %}

{% block title %}{{ chapter.title }}{% endblock %}

{% block head %}
	<script src="/public/js/json-enc.js"></script>
{% endblock %}

{% block content %}
	{% call super() %}
	{% if is_admin %}
		<a href="admin/">Go to Admin Page</a>
	{% endif %}

	{% for (event, pick) in user_picks %}
		{% match event.contents.0 %}
		{% when EventContent::SpreadGroup with (spreads) %}
			{% call spread_group(spreads, pick) %}
		{% when EventContent::UserInput with (input) %}
			{% call user_input(input, pick) %}
		{% endmatch %}
		{% if !loop.last %}
		<hr>
		{% endif %}
	{% else %}
		<p>No Events in this Chapter</p>
	{% endfor %}
	<form id="submit-picks" hx-post="." hx-ext="json-enc" hx-vals="js:{picks: get_forms()}">
		<button type="submit">Submit</button>
	</form>
{% endblock %}

{% macro spread_group(spreads, picks) %}
{% let size = spreads.len() %}

{{ "{:#?}"|format(spreads) }}
{% endmacro %}

{% macro user_input(input, pick) %}
	<form class="pickinputs">
		<h3 class="text-lg font-semibold">{{input.title}}</h3>
		{% if let Some(description) = input.description %}
			<h4>{{description}}</h4>
		{% endif %}
		{% if input.points == 1 %}
			<p>({{input.points}} Point)</p>
		{% else %}
			<p>({{input.points}} Points)</p>
		{% endif %}
		{% if let Some(pick) = pick %}
		<input type="text" name="user-input" placeholder="Your Answer" value={{pick.choice}}>
		{% else %}
		<input type="text" name="user-input" placeholder="Your Answer">
		{% endif %}
	</form>
{% endmacro %}
